<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CARIN RTPBC + BB + DIC Prototype</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Real-Time Pharmacy Benefit Check (RTPBC)</h1>
            <h2>CARIN Digital Insurance Card ‚Üí RTPBC Coverage Transformation Demo</h2>
        </header>

        <section class="intro">
            <h3>Problem Statement</h3>
            <p>The Real-Time Pharmacy Benefit Check (RTPBC) Implementation Guide enables patients to get real-time benefits information about pharmacy prescriptions at the point of prescribing. However, a significant barrier to adoption is that RTPBC requires specific pharmacy benefit identifiers in the Coverage resource:</p>
            <ul style="margin: 10px 0; padding-left: 30px;">
                <li><strong>rxid</strong> - Pharmacy Benefit Member ID</li>
                <li><strong>rxgroup</strong> - Pharmacy Benefit Group ID</li>
                <li><strong>rxbin</strong> - Bank Identification Number (BIN/IIN)</li>
                <li><strong>rxpcn</strong> - Processor Control Number</li>
            </ul>
            <p>These elements are critical for routing pharmacy claims but aren't profiled in the standard CARIN Blue Button (BB) Coverage resources that most payers have already implemented. This creates a gap where existing FHIR implementations can't support RTPBC operations.</p>
            <p><strong>The Solution:</strong> The CARIN Digital Insurance Card (DIC) profile includes all these pharmacy benefit elements. This demo shows how to leverage existing DIC implementations to enable RTPBC, bridging the gap between what's available today and what RTPBC needs.</p>
        </section>

        <section class="demo-flow">
            <h3>Demo Flow</h3>
            <div class="step-indicator">
                <div class="step" id="step-1">
                    <span class="step-number">1</span>
                    <span class="step-label">SMART on FHIR Launch</span>
                </div>
                <div class="step" id="step-2">
                    <span class="step-number">2</span>
                    <span class="step-label">Auth with CARIN BB API</span>
                </div>
                <div class="step" id="step-3">
                    <span class="step-number">3</span>
                    <span class="step-label">Get DIC Coverage Resource</span>
                </div>
                <div class="step" id="step-4">
                    <span class="step-number">4</span>
                    <span class="step-label">Transform to RTPBC</span>
                </div>
                <div class="step" id="step-5">
                    <span class="step-number">5</span>
                    <span class="step-label">Submit RTPBC Request</span>
                </div>
            </div>
        </section>

        <section class="controls">
            <button id="start-btn" class="primary-btn">Start SMART Launch</button>
            <button id="reset-btn" class="secondary-btn" style="display: none;">Reset Demo</button>
        </section>

        <section class="status-panel">
            <h3>Status Log</h3>
            <div id="status-messages"></div>
        </section>

        <section class="debug-panel">
            <h3>Step Details</h3>
            <div class="debug-cards">
                <div class="debug-card" id="debug-step-1">
                    <h4>üöÄ SMART on FHIR Launch</h4>
                    <div class="debug-content">
                        <div class="debug-item">
                            <span class="debug-label">Authorization Endpoint:</span>
                            <span class="debug-value" id="auth-endpoint">-</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">Client ID:</span>
                            <span class="debug-value">rtpbc-demo-client</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">Requested Scopes:</span>
                            <span class="debug-value">patient/*.read launch/patient</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">State Parameter:</span>
                            <span class="debug-value" id="state-param">-</span>
                        </div>
                    </div>
                </div>

                <div class="debug-card" id="debug-step-2">
                    <h4>üîê OAuth Token Exchange</h4>
                    <div class="debug-content">
                        <div class="debug-item">
                            <span class="debug-label">Token Endpoint:</span>
                            <span class="debug-value" id="token-endpoint">-</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">Authorization Code:</span>
                            <span class="debug-value" id="auth-code">-</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">Access Token:</span>
                            <span class="debug-value" id="access-token">-</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">Patient Context:</span>
                            <span class="debug-value" id="patient-context">-</span>
                        </div>
                    </div>
                </div>

                <div class="debug-card" id="debug-step-3">
                    <h4>üìã CARIN DIC Coverage Retrieval</h4>
                    <div class="debug-content">
                        <div class="debug-item">
                            <span class="debug-label">FHIR Endpoint:</span>
                            <span class="debug-value" id="fhir-endpoint">-</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">Coverage Profile:</span>
                            <span class="debug-value">C4DIC-Coverage</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">Response Status:</span>
                            <span class="debug-value" id="response-status">-</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">Resource ID:</span>
                            <span class="debug-value" id="resource-id">-</span>
                        </div>
                    </div>
                </div>

                <div class="debug-card" id="debug-step-4">
                    <h4>üîÑ RTPBC Transformation</h4>
                    <div class="debug-content">
                        <div class="debug-item">
                            <span class="debug-label">RxBIN Extracted:</span>
                            <span class="debug-value" id="rxbin-value">-</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">RxPCN Extracted:</span>
                            <span class="debug-value" id="rxpcn-value">-</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">RxGroup Extracted:</span>
                            <span class="debug-value" id="rxgroup-value">-</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">RxID Extracted:</span>
                            <span class="debug-value" id="rxid-value">-</span>
                        </div>
                    </div>
                </div>

                <div class="debug-card" id="debug-step-5">
                    <h4>üì§ RTPBC Request Submission</h4>
                    <div class="debug-content">
                        <div class="debug-item">
                            <span class="debug-label">PBM Endpoint:</span>
                            <span class="debug-value">https://pbm.example.com/rtpbc (simulated)</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">Request Method:</span>
                            <span class="debug-value">POST</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">Content Type:</span>
                            <span class="debug-value">application/fhir+json</span>
                        </div>
                        <div class="debug-item">
                            <span class="debug-label">Response Time:</span>
                            <span class="debug-value" id="response-time">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="data-display" style="display: none;">
            <div class="data-panel">
                <h3>
                    <a href="https://hl7.org/fhir/us/insurance-card/StructureDefinition-C4DIC-Coverage.html" target="_blank" rel="noopener">
                        CARIN Digital Insurance Card Coverage
                    </a>
                </h3>
                <pre id="dic-coverage" class="json-display"></pre>
            </div>
            
            <div class="transformation-arrow">
                <svg width="60" height="40" viewBox="0 0 60 40">
                    <path d="M 10 20 L 40 20" stroke="#3498db" stroke-width="3" fill="none"/>
                    <path d="M 40 20 L 35 15 M 40 20 L 35 25" stroke="#3498db" stroke-width="3" fill="none"/>
                </svg>
                <span>Transform</span>
            </div>
            
            <div class="data-panel">
                <h3>
                    <a href="https://hl7.org/fhir/us/carin-rtpbc/StructureDefinition-rtpbc-coverage.html" target="_blank" rel="noopener">
                        RTPBC Coverage Resource
                    </a>
                </h3>
                <pre id="rtpbc-coverage" class="json-display"></pre>
            </div>
        </section>

        <section class="mapping-details" style="display: none;">
            <h3>Field Mapping Details</h3>
            <table class="mapping-table">
                <thead>
                    <tr>
                        <th>CARIN DIC Field</th>
                        <th>Value</th>
                        <th>RTPBC Field</th>
                    </tr>
                </thead>
                <tbody id="mapping-tbody"></tbody>
            </table>
        </section>
    </div>

    <script src="app.js"></script>
</body>
</html>